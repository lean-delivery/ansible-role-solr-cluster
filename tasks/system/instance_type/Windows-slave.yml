---
- name: Configure solr node as slave
  win_lineinfile:
    path: '{{ solr_configset_path }}/{{ item.item | win_basename }}\conf\solrconfig.xml'
    insertafter: '.*<requestHandler name="/replication" class="solr.ReplicationHandler".*>'
    line:
      '<!-- BEGIN solr ansible custom block --> <lst name="slave">
      <str name="masterUrl">{{ solr_master_generated_url }}</str>
      <str name="pollInterval">00:00:60</str> </lst>
      <!-- END solr ansible custom block -->'
    regexp:
      '<!--\sBEGIN\ssolr\sansible\scustom\sblock(.*)
      END\ssolr\sansible\scustom\sblock\s-->'
  when: item.stdout_lines | length
  loop: '{{ true_configset_xml_list.results }}'
  notify:
    - restart Solr Windows
